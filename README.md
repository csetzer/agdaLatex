# Integrating Agda Files into Latex

The code in this directory is based on files created by
  Andreas Abel, Stephan Adelsberger, Anton Setzer.

The standard way to produce LaTeX documents incorporating Agda code is to write a literate Agda (`.lagda`)
file and use `agda --latex` command to generate the LaTeX source code.  However, there are certain situations
in which this approach is inconvenient or impossible.  (TODO: give some examples)

This directory contains a `Makefile` with some additional scripts and example latex, bibtex, and agda files which allows to integrate agda files into Latex files, by using normal agda files (no need to use lagda).
The script will take tagged Agda files and generate LaTeX code and macros.

## Slides

[slidesCodesprintProposal-AgdaMeetingXXXVIII-SwanseaMay2024.pdf][]

contains slides for presenting the original proposal for a code sprint
at the Agda Implementors Meeting XXXVIII, Swansea, 13 May 2024.


## Example

### Running the example

Download the repository and execute it by invoking `make` in the main parent directory of the repo.

### Explanation: preliminaries

The paths `mainLatexFiles`, `agda`, `_generatedLagda`, `_agdaLatex-before-sed`, `_agdaLatex` 
used in the following can be customized in the `Makefile`.

**The main example**: `mainLatexFiles/exampleMainLatexFile1.tex`

The LaTeX file `exampleMainLatexFile1.tex` makes references to code in the Agda file 
`agda/example.agda`.

Running `make` generates the agdaLatex file `latex/example.tex` which defines LaTeX macros
pointing to certain blocks of Agda code. When used in a LaTeX file, these macros add the 
Agda code blocks to the LaTeX file.

The `make` command will also run `pdflatex` and `bibtex` on the file
`mainLatexFiles/exampleMainLatexFile1.tex`.


### Explanation: tags

The file `example.agda` starts with `--@PREFIX@example` which sets the prefix to "example."

This prefix will be added in front of all LaTeX macros derived from the `example.agda` file.
We recommend using a prefix with a name that indicates the Agda file that generates the LaTeX 
macros and code as this will make it easier to find that Agda file when it needs to be 
inspected or adjusted.

*Note* LaTeX only allows normal characters (in particular no digits) in macros.  However, numbers often appear in names of Agda files.  A workaround is to use e.g. "one" for "1", "two" for "2", etc.

The file `example.agda` tags the Agda code defining the natural numbers with name "N" using

``` agda
--@BEGIN@N
--@END
```

From this name "N" and the prefix "example" the macro `\exampleN` is generated 
(where "exampleN"  =  "example" ++ "N").

Furthermore, the agda file has tags introducing the macros `\exampleU` and `\exampleT`, 
the latter of which is for inline code.

The file `mainLatexFiles/exampleMainLatexFile1.tex` gives example uses for these 
macros from which a LaTeX file is generated by running `make`.


## Setup of LaTeX files

The macro file `mainLatexFiles/macrosAgdaAdaption.tex` loads the file
`agda.sty` which will appear in `_agdaLatex/agda.sty`.
(If you add your own adapted file there it should stay there.)

For Unicode characters, some macros are defined in
`mainLatexFiles/macrosAgdaAdaption.tex`
such as
`\DeclareUnicodeCharacter{2115}{\ensuremath{\mathbb{N}}}`
which defines the Unicode character 0x2115 (blackboard-bold face N) as the LaTeX code for the natural numbers.
Over time more characters will be added to this file.

If you get an error stemming from a unicode problem, it's usually best to search online for unicode and the hexcode displayed, and then define a corresponding LaTeX definition.

**Note** If you use the LaTeX style file `inputenc`, then you should use `utf` instead of `utfx` (the latter is no longer maintained).

You need to include the generated LaTeX file and the `macrosAgdaAdaption.tex`
in the main LaTeX file.  For example, in `mainLatexFiles/exampleMainLatexFile1.tex` this is done
with the lines

``` tex
\input macrosAgdaAdaption
\input ../_agdaLatex/example.tex
\input ../_agdaLatex/example2.tex
```


## Required Software

You need to have
awk, sed, GNU make, pdflatex, bibtex, agda
installed.

If using Windows you might need to install Ubuntu as a Windows subsystem WSL (supported from the Microsoft store).


## Main commands for creating generated latex files (called agdaLatex files) and running LaTeX

The command

`make`

will create the generated latex files and execute pdflatex and bibtex on the file `mainLatexFiles/mainLatexFile1`.

To do the same for `mainLatexFiles/mainLatexFile2` execute `make default2`.


## Precise Syntax for Agda files

This file generates from Agda files
latex file which contain definitions

\newcommand{\mymacro}{...}

Inserting `\mymacro` in a LaTeX file will then add the document Agda code from the file used to generate the macro.  Example files are

``` sh
agda/example.agda
agda/example2.agda
```

The name of mymacro is formed from
- a global prefix which you define at the beginning of the agda file to indicate which agda file you are referring to
- a name you give to your definition

At the beginning of your Agda file a line like

``` agda
--@PREFIX@myprefix
```

defines the prefix to be used for the macro names associated with the code in this Agda file.

Then for each Agda code block that you might wish to include in your LaTeX document, you use the following:

``` agda
--@BEGIN@name
some agda code
--@END
```

Both `myprefix` and `name` should only contain normal letters and no digits, since a LaTeX macro is generated from these.

The code will generate a LaTeX macro
`\newcommand{\mymacro}{...}`
where `mymacro` will be the concatenation of `myprefix` and `name`.

For instance in
`agda/example.agda`
the prefix is given by

``` agda
--@PREFIX@example
```

and the Agda code block starting with

``` agda
--@BEGIN@N
```

and ending with

``` agda
--@END
```

generates the macro `\exampleN`.


### inline code
In order to create inline code, instead of `--@BEGIN@name`, use

``` agda
--@BEGIN-inline@name
```


## Alignment of of code in Agda files

In order to avoid overalignment, only code which is preceded by double blanks is aligned (as it the standard for lagda files.

Note that some Unicode characters are shorter or longer when displayed in Agda, whereas for alignment purposes they count as single characters. By moving in Emacs cursor up and down you can find out where the correct position is.


## Configuration

We now describe organizational structure of the example project.  Other projects using `agdaLatex` should follow a similar structure.

- `mainLatexFileDir1`: directory containing the main LaTeX files  
  (default: `mainLatexFiles`)

- `mainAgdaDir`: directory containing the Agda files used to generate LaTeX macros for inserting Agda blocks into LaTeX files  
  (default: `agda`)

- `generatedLagdaDir`: directory where generated `.lagda` files are moved to after being generated from Agda files  
  (default: `_lagda`)

- `generatedAgdaLatexBeforeSedFileDir`: directory where intermediate latex files are placed  
  (default: `_agdaLatex-before-sed`)

- `generatedAgdaLatexFileDir`: directory where "agdaLatex" files (LaTeX files generated from the agda files) are placed  
  (default: `_agdaLatex`)

- `mainLatexFile1`, `mainLatexFile2`: the two main Latex Files on which `pdflatex` and `bibtex` are executed

- `bibtexMainLatexFile1`, `bibtexMainLatexFile2`: determine whether to run `bibtex` on `mainLatexFile1` or `mainLatexFile2`, respectively


**NOTE:** Do not edit
`generatedLagdaDir`, `generatedAgdaLatexBeforeSedFileDir`, `generatedAgdaLatexFileDir`
since the files are automatically generated, so your edits may be overwritten or deleted.

## Type-checking of Agda files

The code will type-check all original agda files, and will generated the latex files from the generated lagda files without type-checking. This should reduce the amount of time used for type-checking.
The type-checking is a precaution so that you have the guaranteed that all agda files used are properly type-checked.

[slidesCodesprintProposal-AgdaMeetingXXXVIII-SwanseaMay2024.pdf]: https://github.com/williamdemeo/agdaLatex/blob/main/slidesCodesprintProposal-AgdaMeetingXXXVIII-SwanseaMay2024.pdf

